package com.iskaypet.core;import io.javalin.Javalin;import io.javalin.config.JavalinConfig;import io.javalin.http.Context;import io.javalin.micrometer.MicrometerPlugin;import io.micrometer.prometheusmetrics.PrometheusConfig;import io.micrometer.prometheusmetrics.PrometheusMeterRegistry;import io.reactivex.rxjava3.core.Observable;import java.util.function.Consumer;import java.util.function.Function;public record Server(Javalin javalin) {    static PrometheusMeterRegistry prometheusMeterRegistry = new PrometheusMeterRegistry(        PrometheusConfig.DEFAULT);    static MicrometerPlugin micrometerPlugin = new MicrometerPlugin(        micrometerPluginConfig -> micrometerPluginConfig.registry = prometheusMeterRegistry);    public static Server create() {        return create(config -> {            config.useVirtualThreads = true;            config.showJavalinBanner = false;            config.registerPlugin(micrometerPlugin);        });    }    public static Server create(Consumer<JavalinConfig> config) {        return new Server(Javalin.create(config));    }    public <T> void get(String path, Function<Context, Observable<T>> handler) {        this.javalin.get(path, RxHttpHandler.intercept(handler));    }    public void start(int port) {        this.javalin.get("/metrics",            ctx -> ctx.contentType("text/plain; version=0.0.4; charset=utf-8")                .result(prometheusMeterRegistry.scrape()));        this.javalin.get("/ping",            ctx -> ctx.contentType("text/plain; version=0.0.4; charset=utf-8")                .result("pong"));        this.javalin.start("0.0.0.0", port);    }}